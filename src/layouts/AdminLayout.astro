---
interface Props {
  title?: string;
}

const { title = 'ç®¡ç†åå°' } = Astro.props as Props;
---

<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>{title} - å°ç™½å¤©åœ°</title>
  <link rel="stylesheet" href="/admin/styles/admin.css">
  <link rel="stylesheet" href="/admin/styles/enhanced-markdown-editor.css">
</head>
<body>
  <div class="admin-wrapper">
    <aside class="admin-sidebar">
      <div class="admin-logo">
        <h2>ç®¡ç†åå°</h2>
      </div>
      <nav class="admin-nav">
        <a href="/admin/" class="nav-link">ä»ªè¡¨æ¿</a>
        <a href="/admin/content" class="nav-link">å†…å®¹ç®¡ç†</a>
        <a href="/admin/categories" class="nav-link">æ ç›®ç®¡ç†</a>
        <a href="/admin/menus" class="nav-link">å¯¼èˆªç®¡ç†</a>
        <a href="/admin/social" class="nav-link">ç¤¾äº¤åª’ä½“</a>
        <a href="/admin/gallery" class="nav-link">å…‰å½±ç®¡ç†</a>
        <a href="/admin/analytics" class="nav-link">è®¿é—®ç»Ÿè®¡</a>
        <a href="/admin/seo" class="nav-link">SEOä¼˜åŒ–</a>
        <a href="/admin/ads" class="nav-link">å¹¿å‘Šç®¡ç†</a>
        <a href="/admin/settings" class="nav-link">ç½‘ç«™è®¾ç½®</a>
        <a href="/admin/python-integration" class="nav-link">PythonåŠŸèƒ½</a>
      </nav>
      
      <div class="mt-auto pt-6 border-t border-gray-700">
        <button id="deploy-btn" class="w-full py-2 px-4 bg-green-600 hover:bg-green-700 text-white rounded transition-colors flex items-center justify-center gap-2">
            <span class="text-xl">ğŸš€</span> å‘å¸ƒä¸Šçº¿
        </button>
      </div>
    </aside>
    <main class="admin-main">
      <header class="admin-header">
        <h1>{title}</h1>
      </header>
      <div class="admin-content">
        <slot />
      </div>
    </main>
  </div>

  <!-- å…¨å±€ Toast å®¹å™¨ -->
  <div id="toast-container"></div>

  <script is:inline>
    // å‘å¸ƒæŒ‰é’®é€»è¾‘
    const deployBtn = document.getElementById('deploy-btn');
    if (deployBtn) {
        deployBtn.addEventListener('click', async () => {
            if (!confirm('ç¡®å®šè¦å°†å½“å‰å†…å®¹å‘å¸ƒåˆ°å…¬å¼€ç½‘ç«™å—ï¼Ÿ')) return;
            
            const originalText = deployBtn.innerHTML;
            deployBtn.disabled = true;
            deployBtn.innerHTML = '<span class="animate-spin">â†»</span> å‘å¸ƒä¸­...';
            
            try {
                const res = await fetch('/api/deploy', { method: 'POST' });
                const result = await res.json();
                
                if (res.ok) {
                    window.showToast('å‘å¸ƒæˆåŠŸï¼', 'success');
                } else {
                    window.showToast('å‘å¸ƒå¤±è´¥: ' + result.error, 'error');
                    console.error(result.details);
                }
            } catch (e) {
                window.showToast('è¯·æ±‚å‡ºé”™', 'error');
            } finally {
                deployBtn.disabled = false;
                deployBtn.innerHTML = originalText;
            }
        });
    }

    // å…¨å±€ Toast å‡½æ•°
    window.showToast = (message, type = 'success') => {
      const container = document.getElementById('toast-container');
      const toast = document.createElement('div');
      
      const icons = {
        success: '<svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path></svg>',
        error: '<svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg>',
        info: '<svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>'
      };

      const colors = {
        success: 'bg-green-500',
        error: 'bg-red-500',
        info: 'bg-blue-500'
      };

      toast.className = `toast-item ${type}`;
      toast.innerHTML = `
        <div class="toast-icon">${icons[type] || icons.info}</div>
        <div class="toast-message">${message}</div>
      `;

      container.appendChild(toast);

      // åŠ¨ç”»è¿›å…¥
      requestAnimationFrame(() => {
        toast.classList.add('show');
      });

      // 3ç§’åç§»é™¤
      setTimeout(() => {
        toast.classList.remove('show');
        setTimeout(() => {
          container.removeChild(toast);
        }, 300);
      }, 3000);
    };
  </script>

  <style is:global>
    #toast-container {
      position: fixed;
      top: 20px;
      right: 20px;
      z-index: 9999;
      display: flex;
      flex-direction: column;
      gap: 10px;
    }

    .toast-item {
      display: flex;
      align-items: center;
      min-width: 300px;
      padding: 12px 16px;
      background: white;
      border-radius: 8px;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
      transform: translateX(120%);
      transition: transform 0.3s ease-out;
      border-left: 4px solid #3498db;
    }

    .toast-item.show {
      transform: translateX(0);
    }

    .toast-item.success { border-left-color: #2ecc71; }
    .toast-item.error { border-left-color: #e74c3c; }
    .toast-item.info { border-left-color: #3498db; }

    .toast-icon {
      margin-right: 12px;
      display: flex;
      align-items: center;
    }
    
    .toast-icon svg {
        width: 20px;
        height: 20px;
    }

    .toast-item.success .toast-icon { color: #2ecc71; }
    .toast-item.error .toast-icon { color: #e74c3c; }
    .toast-item.info .toast-icon { color: #3498db; }

    .toast-message {
      color: #333;
      font-size: 14px;
      font-weight: 500;
    }
  </style>
</body>
</html>