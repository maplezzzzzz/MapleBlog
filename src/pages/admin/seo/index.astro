---
import Layout from '../../../layouts/AdminLayout.astro';

const title = 'SEO优化';
---

<Layout title={title}>
  <div class="admin-container">
    <h2>SEO优化</h2>
    
    <form class="admin-form" id="seo-settings-form">
      <div class="form-group">
        <label for="site-title">网站标题</label>
        <input type="text" id="site-title" name="siteTitle" placeholder="网站的主要标题">
      </div>
      
      <div class="form-group">
        <label for="site-description">网站描述</label>
        <textarea id="site-description" name="siteDescription" placeholder="网站的简短描述，用于搜索引擎摘要"></textarea>
      </div>
      
      <div class="form-group">
        <label for="site-keywords">关键词</label>
        <input type="text" id="site-keywords" name="siteKeywords" placeholder="用逗号分隔的关键词">
      </div>
      
      <div class="form-group">
        <label for="og-title">Open Graph 标题</label>
        <input type="text" id="og-title" name="ogTitle" placeholder="社交媒体分享时显示的标题">
      </div>
      
      <div class="form-group">
        <label for="og-description">Open Graph 描述</label>
        <textarea id="og-description" name="ogDescription" placeholder="社交媒体分享时显示的描述"></textarea>
      </div>
      
      <div class="form-group">
        <label for="og-image">Open Graph 图片URL</label>
        <input type="text" id="og-image" name="ogImage" placeholder="社交媒体分享时显示的图片URL">
      </div>
      
      <div class="form-group">
        <label for="twitter-card">Twitter Card 类型</label>
        <select id="twitter-card" name="twitterCard">
          <option value="summary">Summary</option>
          <option value="summary_large_image">Summary Large Image</option>
          <option value="app">App</option>
          <option value="player">Player</option>
        </select>
      </div>
      
      <div class="form-group">
        <label for="google-analytics">Google Analytics ID</label>
        <input type="text" id="google-analytics" name="googleAnalytics" placeholder="如: GA-XXXXXXXX-X">
      </div>
      
      <div class="form-group">
        <label for="bing-verification">Bing 网站验证</label>
        <input type="text" id="bing-verification" name="bingVerification" placeholder="Bing 网站验证代码">
      </div>
      
      <div class="form-group">
        <label for="robots-txt">Robots.txt 内容</label>
        <textarea id="robots-txt" name="robotsTxt" placeholder="自定义 robots.txt 内容"></textarea>
      </div>
      
      <div class="form-group">
        <label for="sitemap-frequency">Sitemap 更新频率</label>
        <select id="sitemap-frequency" name="sitemapFrequency">
          <option value="always">总是</option>
          <option value="hourly">每小时</option>
          <option value="daily" selected>每天</option>
          <option value="weekly">每周</option>
          <option value="monthly">每月</option>
          <option value="yearly">每年</option>
          <option value="never">从不</option>
        </select>
      </div>
      
      <div class="form-actions">
        <button type="submit" class="admin-btn">保存设置</button>
        <button type="button" class="admin-btn admin-btn-secondary" onclick="previewSEO()">预览SEO</button>
      </div>
    </form>
    
    <div class="seo-analysis">
      <h3>SEO分析</h3>
      <div class="analysis-metrics">
        <div class="metric-card">
          <h4>页面加载速度</h4>
          <p id="load-speed-score">--</p>
        </div>
        <div class="metric-card">
          <h4>移动端友好</h4>
          <p id="mobile-score">--</p>
        </div>
        <div class="metric-card">
          <h4>结构化数据</h4>
          <p id="structured-score">--</p>
        </div>
        <div class="metric-card">
          <h4>可访问性</h4>
          <p id="accessibility-score">--</p>
        </div>
      </div>
    </div>
  </div>

  <script>
    // 加载当前SEO设置
    async function loadSEOSettings() {
      try {
        const response = await fetch('/api/seo/settings');
        if (response.ok) {
          const settings = await response.json();

          const elementsMap: { [key: string]: string } = {
            'site-title': settings.siteTitle || '',
            'site-description': settings.siteDescription || '',
            'site-keywords': settings.siteKeywords || '',
            'og-title': settings.ogTitle || '',
            'og-description': settings.ogDescription || '',
            'og-image': settings.ogImage || '',
            'twitter-card': settings.twitterCard || 'summary',
            'google-analytics': settings.googleAnalytics || '',
            'bing-verification': settings.bingVerification || '',
            'robots-txt': settings.robotsTxt || '',
            'sitemap-frequency': settings.sitemapFrequency || 'daily'
          };

          Object.entries(elementsMap).forEach(([id, value]) => {
            const element = document.getElementById(id);
            if (element) {
              (element as HTMLInputElement).value = value;
            }
          });
        }
      } catch (error) {
        console.error('加载SEO设置失败:', error);
      }
    }

    // 保存SEO设置
    const seoSettingsForm = document.getElementById('seo-settings-form');
    if (seoSettingsForm) {
      seoSettingsForm.addEventListener('submit', async (e: Event) => {
        e.preventDefault();

        const formData = new FormData(e.target as HTMLFormElement);
        const settings = Object.fromEntries(formData.entries());

        try {
          const response = await fetch('/api/seo/settings', {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json'
            },
            body: JSON.stringify(settings)
          });

          if (response.ok) {
            alert('SEO设置保存成功！');
          } else {
            alert('保存失败，请重试。');
          }
        } catch (error) {
          console.error('保存SEO设置失败:', error);
          alert('保存失败，请重试。');
        }
      });
    }
    
    // 加载SEO分析数据
    async function loadSEOAnalysis() {
      try {
        // 模拟加载数据
        document.getElementById('load-speed-score').textContent = '95/100';
        document.getElementById('mobile-score').textContent = '90/100';
        document.getElementById('structured-score').textContent = '85/100';
        document.getElementById('accessibility-score').textContent = '88/100';
      } catch (error) {
        console.error('加载SEO分析数据失败:', error);
      }
    }
    
    function previewSEO() {
      alert('SEO预览功能将在完整实现后提供');
    }
    
    // 页面加载时获取数据
    document.addEventListener('DOMContentLoaded', () => {
      loadSEOSettings();
      loadSEOAnalysis();
    });
  </script>
  
  <style>
    .seo-analysis {
      margin-top: 40px;
    }
    
    .analysis-metrics {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 20px;
      margin-top: 20px;
    }
    
    .metric-card {
      background: white;
      padding: 20px;
      border-radius: 8px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
      text-align: center;
    }
    
    .metric-card h4 {
      margin: 0 0 10px 0;
      color: #7f8c8d;
      font-size: 14px;
    }
    
    .metric-card p {
      margin: 0;
      font-size: 24px;
      font-weight: bold;
      color: #27ae60;
    }
    
    .form-actions {
      margin-top: 20px;
      display: flex;
      gap: 10px;
    }
  </style>
</Layout>