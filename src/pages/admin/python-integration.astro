---
import Layout from '../../layouts/AdminLayout.astro';
---

<Layout title="Python åŠŸèƒ½é›†æˆ">
  <div class="admin-container">
    <div class="flex justify-between items-center mb-6">
      <h2>ğŸ Python åŠŸèƒ½é›†æˆ</h2>
      <div id="service-status" class="status-badge checking">æ£€æŸ¥æœåŠ¡ä¸­...</div>
    </div>

    <div class="dashboard-grid">
      <!-- æœåŠ¡æ¦‚è§ˆ -->
      <div class="dashboard-card full-width">
        <h3>æœåŠ¡çŠ¶æ€</h3>
        <p>æ­¤æ¨¡å—è¿æ¥åˆ°è¿è¡Œåœ¨ç«¯å£ 8000 çš„ FastAPI æœåŠ¡ï¼Œæä¾› AI æ–‡æœ¬åˆ†æã€SEO ä¼˜åŒ–å»ºè®®å’Œå†…å®¹è´¨é‡æ£€æµ‹ã€‚</p>
        <div class="api-info mt-4">
          <code>API Endpoint: http://localhost:8000</code>
        </div>
      </div>

      <!-- åŠŸèƒ½æµ‹è¯• -->
      <div class="dashboard-card">
        <h3>æƒ…æ„Ÿåˆ†ææµ‹è¯•</h3>
        <textarea id="analysis-text" class="form-input mb-4" rows="3" placeholder="è¾“å…¥ä¸€æ®µæ–‡å­—è¿›è¡Œæƒ…æ„Ÿåˆ†æ..."></textarea>
        <button id="test-analysis-btn" class="admin-btn">å¼€å§‹åˆ†æ</button>
        <div id="analysis-result" class="result-box mt-4 hidden"></div>
      </div>

      <div class="dashboard-card">
        <h3>å†…å®¹ä¼˜åŒ–å»ºè®®</h3>
        <p class="text-gray-600 mb-4">è‡ªåŠ¨æ£€æµ‹æ–‡ç« çš„å…³é”®è¯å¯†åº¦ã€é˜…è¯»éš¾åº¦å’Œ SEO è¯„åˆ†ã€‚</p>
        <button class="admin-btn admin-btn-secondary" disabled>å‰å¾€ç¼–è¾‘å™¨ä½¿ç”¨</button>
      </div>
    </div>
  </div>

  <script>
    async function checkStatus() {
      const badge = document.getElementById('service-status');
      try {
        const response = await fetch('http://localhost:8000/health');
        if (response.ok) {
          badge.textContent = 'â— æœåŠ¡è¿è¡Œä¸­';
          badge.className = 'status-badge published';
        } else {
          throw new Error();
        }
      } catch (e) {
        badge.textContent = 'â— æœåŠ¡æœªå¯åŠ¨';
        badge.className = 'status-badge archived';
      }
    }

    // æƒ…æ„Ÿåˆ†ææµ‹è¯•é€»è¾‘
    const testBtn = document.getElementById('test-analysis-btn');
    const resultBox = document.getElementById('analysis-result');
    const textArea = document.getElementById('analysis-text');

    if (testBtn) {
      testBtn.addEventListener('click', async () => {
        const text = textArea.value.trim();
        if (!text) return alert('è¯·è¾“å…¥æ–‡å­—');

        testBtn.disabled = true;
        testBtn.textContent = 'åˆ†æä¸­...';
        resultBox.classList.remove('hidden');
        resultBox.textContent = 'è¯·æ±‚ä¸­...';

        try {
          const response = await fetch('http://localhost:8000/api/text-analysis', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ text, language: 'zh' })
          });
          const data = await response.json();
          resultBox.innerHTML = `<pre>${JSON.stringify(data, null, 2)}</pre>`;
        } catch (e) {
          resultBox.textContent = 'åˆ†æå¤±è´¥ï¼šè¯·ç¡®ä¿ Python API å·²å¯åŠ¨ã€‚';
        } finally {
          testBtn.disabled = false;
          testBtn.textContent = 'å¼€å§‹åˆ†æ';
        }
      });
    }

    checkStatus();
  </script>

  <style>
    .dashboard-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
      gap: 20px;
    }
    
    .dashboard-card {
      background: white;
      padding: 20px;
      border-radius: 8px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.05);
    }

    .full-width {
      grid-column: 1 / -1;
    }

    .status-badge.checking {
      background: #e1e5e9;
      color: #6c757d;
    }

    .result-box {
      background: #f8f9fa;
      padding: 15px;
      border-radius: 4px;
      font-family: monospace;
      font-size: 13px;
      max-height: 200px;
      overflow-y: auto;
    }

    .hidden { display: none; }
    .mt-4 { margin-top: 1rem; }
    .mb-4 { margin-bottom: 1rem; }
    .mb-6 { margin-bottom: 1.5rem; }
    .text-gray-600 { color: #718096; }
  </style>
</Layout>