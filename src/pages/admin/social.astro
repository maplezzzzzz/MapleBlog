---
import Layout from '../../layouts/AdminLayout.astro';
---

<Layout title="ç¤¾äº¤åª’ä½“ç®¡ç†">
  <div class="admin-container">
    <h2>ğŸ’¬ ç¤¾äº¤åª’ä½“é…ç½®</h2>
    <p class="text-gray-500 mb-6">é…ç½®å…¨ç«™é€šç”¨çš„ç¤¾äº¤åª’ä½“é“¾æ¥ï¼Œå°†æ˜¾ç¤ºåœ¨é¡µè„šå³ä¸‹è§’åŠå…³äºé¡µé¢ã€‚</p>
    
    <div class="bg-white p-6 rounded-lg shadow-sm">
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6" id="social-form">
            <!-- å›½å†…å¸¸ç”¨ -->
            <div class="col-span-1 md:col-span-2">
                <h3 class="text-lg font-bold border-b pb-2 mb-4">å›½å†…å¸¸ç”¨</h3>
            </div>
            
            <div class="form-group">
                <label class="block text-sm font-medium text-gray-700 mb-1">
                    <span class="mr-2">ğŸŸ¢</span> å¾®ä¿¡ (WeChat)
                </label>
                <input type="text" name="wechat" class="form-input w-full" placeholder="å¾®ä¿¡å·æˆ–äºŒç»´ç é“¾æ¥">
                <p class="text-xs text-gray-400 mt-1">å°†åœ¨ç‚¹å‡»æ—¶æ˜¾ç¤ºå¼¹çª—æˆ–å¤åˆ¶</p>
            </div>

            <div class="form-group">
                <label class="block text-sm font-medium text-gray-700 mb-1">
                    <span class="mr-2">ğŸ“•</span> å°çº¢ä¹¦ (XHS)
                </label>
                <input type="text" name="xhs" class="form-input w-full" placeholder="ä¸»é¡µé“¾æ¥">
            </div>

            <div class="form-group">
                <label class="block text-sm font-medium text-gray-700 mb-1">
                    <span class="mr-2">ğŸ”´</span> å¾®åš (Weibo)
                </label>
                <input type="text" name="weibo" class="form-input w-full" placeholder="ä¸»é¡µé“¾æ¥">
            </div>

            <div class="form-group">
                <label class="block text-sm font-medium text-gray-700 mb-1">
                    <span class="mr-2">ğŸ“§</span> é‚®ç®± (Email)
                </label>
                <input type="text" name="email" class="form-input w-full" placeholder="mailto:your@email.com">
            </div>

            <!-- å›½é™…/æŠ€æœ¯ -->
            <div class="col-span-1 md:col-span-2 mt-4">
                <h3 class="text-lg font-bold border-b pb-2 mb-4">å›½é™… / æŠ€æœ¯ç¤¾åŒº</h3>
            </div>

            <div class="form-group">
                <label class="block text-sm font-medium text-gray-700 mb-1">
                    <span class="mr-2">ğŸ±</span> GitHub
                </label>
                <input type="text" name="github" class="form-input w-full" placeholder="GitHub ä¸»é¡µé“¾æ¥">
            </div>

            <div class="form-group">
                <label class="block text-sm font-medium text-gray-700 mb-1">
                    <span class="mr-2">ğŸ“º</span> YouTube
                </label>
                <input type="text" name="youtube" class="form-input w-full" placeholder="é¢‘é“é“¾æ¥">
            </div>
            
             <div class="form-group">
                <label class="block text-sm font-medium text-gray-700 mb-1">
                    <span class="mr-2">ğŸ“·</span> Instagram
                </label>
                <input type="text" name="instagram" class="form-input w-full" placeholder="ä¸»é¡µé“¾æ¥">
            </div>

            <div class="form-group">
                <label class="block text-sm font-medium text-gray-700 mb-1">
                    <span class="mr-2">ğŸ¦</span> Twitter / X
                </label>
                <input type="text" name="twitter" class="form-input w-full" placeholder="ä¸»é¡µé“¾æ¥">
            </div>
            
             <div class="form-group">
                <label class="block text-sm font-medium text-gray-700 mb-1">
                    <span class="mr-2">ğŸ“˜</span> Facebook
                </label>
                <input type="text" name="facebook" class="form-input w-full" placeholder="ä¸»é¡µé“¾æ¥">
            </div>
            
             <div class="form-group">
                <label class="block text-sm font-medium text-gray-700 mb-1">
                    <span class="mr-2">ğŸ’¼</span> LinkedIn
                </label>
                <input type="text" name="linkedIn" class="form-input w-full" placeholder="ä¸ªäººèµ„æ–™é“¾æ¥">
            </div>
            
            <div class="form-group">
                <label class="block text-sm font-medium text-gray-700 mb-1">
                    <span class="mr-2">ğŸ“¡</span> RSS
                </label>
                <input type="text" name="rss" class="form-input w-full" placeholder="/rss.xml">
            </div>
        </div>

        <div class="mt-8 flex justify-end">
            <button id="save-btn" class="admin-btn admin-btn-primary px-8 py-3 text-base">ä¿å­˜é…ç½®</button>
        </div>
    </div>
  </div>

  <script>
    // åŠ è½½æ•°æ®
    async function loadData() {
        try {
            const res = await fetch('/api/social');
            if (res.ok) {
                const data = await res.json();
                fillForm(data);
            }
        } catch (e) {
            console.error(e);
            window.showToast('åŠ è½½é…ç½®å¤±è´¥', 'error');
        }
    }

    function fillForm(data) {
        const inputs = document.querySelectorAll('#social-form input');
        inputs.forEach((input: any) => {
            const name = input.name;
            if (data[name]) {
                input.value = data[name];
            }
        });
    }

    // ä¿å­˜æ•°æ®
    document.getElementById('save-btn')?.addEventListener('click', async () => {
        const btn = document.getElementById('save-btn');
        const originalText = btn.textContent;
        btn.disabled = true;
        btn.textContent = 'ä¿å­˜ä¸­...';

        const formData = {};
        const inputs = document.querySelectorAll('#social-form input');
        inputs.forEach((input: any) => {
            if (input.value.trim()) {
                formData[input.name] = input.value.trim();
            }
        });

        try {
            const res = await fetch('/api/social', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(formData)
            });

            if (res.ok) {
                window.showToast('ç¤¾äº¤åª’ä½“é…ç½®å·²æ›´æ–°ï¼', 'success');
            } else {
                window.showToast('ä¿å­˜å¤±è´¥', 'error');
            }
        } catch (e) {
            console.error(e);
            window.showToast('ä¿å­˜å‡ºé”™', 'error');
        } finally {
            btn.disabled = false;
            btn.textContent = originalText;
        }
    });

    // åˆå§‹åŒ–
    loadData();
  </script>

  <style>
    .form-input {
        border: 1px solid #ddd;
        border-radius: 6px;
        padding: 10px 12px;
        transition: border-color 0.2s;
    }
    .form-input:focus {
        border-color: #3498db;
        outline: none;
        box-shadow: 0 0 0 2px rgba(52,152,219,0.1);
    }
    .admin-btn-primary {
        background-color: #3498db;
        color: white;
        border-radius: 6px;
        font-weight: 500;
        transition: all 0.2s;
    }
    .admin-btn-primary:hover {
        background-color: #2980b9;
        transform: translateY(-1px);
        box-shadow: 0 4px 6px rgba(52,152,219,0.2);
    }
  </style>
</Layout>
