---
import fs from 'fs';
import path from 'path';
import { fileURLToPath } from 'url';

const __filename = fileURLToPath(import.meta.url);
const __dirname = path.dirname(__filename);
const ROOT_DIR = path.resolve(__dirname, '../../../..');

const uploadsDir = path.join(ROOT_DIR, 'public', 'uploads');
const assetsUploadsDir = path.join(ROOT_DIR, 'public', 'assets', 'uploads');

let uploadsFiles = [];
let assetsUploadsFiles = [];

if (fs.existsSync(uploadsDir)) {
  uploadsFiles = fs.readdirSync(uploadsDir);
}

if (fs.existsSync(assetsUploadsDir)) {
  assetsUploadsFiles = fs.readdirSync(assetsUploadsDir);
}
---

import Layout from '../../layouts/AdminLayout.astro';

<Layout title="文件系统测试">
  <div class="admin-container">
    <h2>文件系统和静态资源测试</h2>
    
    <div>
      <h3>/public/uploads 目录文件:</h3>
      <ul>
        {uploadsFiles.map(file => (
          <li key={file}>
            <a href={`/uploads/${file}`} target="_blank">{file}</a>
          </li>
        ))}
      </ul>
    </div>
    
    <div>
      <h3>/public/assets/uploads 目录文件:</h3>
      <ul>
        {assetsUploadsFiles.map(file => (
          <li key={file}>
            <a href={`/assets/uploads/${file}`} target="_blank">{file}</a>
          </li>
        ))}
      </ul>
    </div>
    
    <div>
      <h3>测试图片显示:</h3>
      <p>以下图片来自 /public/uploads 目录:</p>
      {uploadsFiles.filter(file => /\.(jpg|jpeg|png|gif|webp)$/i.test(file)).map(file => (
        <div key={file} style="margin: 10px; display: inline-block;">
          <h4>{file}</h4>
          <img src={`/uploads/${file}`} alt={file} style="max-width: 200px; height: auto;" onerror="console.error(`图片加载失败: /uploads/${file}`)" onload="console.log(`图片加载成功: /uploads/${file}`)">
        </div>
      ))}
    </div>
  </div>
</Layout>